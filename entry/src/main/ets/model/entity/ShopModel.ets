// å•†åº—æ¨¡å‹
/**
 * åˆ†ç±»æ¨¡å‹
 */
export class CategoryVO {
  id: number; // ç¼–å·
  type: number; // ç±»å‹
  name: string; //åç§°
  sort: number; //æ’åº
  status: number; //çŠ¶æ€ 0 ç¦ç”¨ 1 å¯ç”¨

  constructor(id: number, type: number, name: string, sort: number, status: number) {
    this.id = id;
    this.type = type;
    this.name = name;
    this.sort = sort;
    this.status = status;
  }
}

/**
 * å•†å®¶/åº—é“ºæ¨¡å‹ (API 1.2 & 1.3)
 */
export interface ShopVO {
  id: number;
  name: string;
  avatar: string; // ä¸´æ—¶ OSS é¢„ç­¾å URL
  score: number; // è¯„åˆ†
  monthlySales: number; // æœˆå”®
  deliveryPrice: number; // èµ·é€ä»·
  shippingFee: number; // é…é€è´¹
  averageDeliveryTime: number; // å¹³å‡é…é€æ—¶é—´ (åˆ†é’Ÿ)
  distance?: string; // è·ç¦» (ç”±åç«¯è®¡ç®—ï¼Œå¦‚ "1.2km")
  status: number; // 0: ä¼‘æ¯ä¸­, 1: è¥ä¸šä¸­
  description?: string; // åº—é“ºå…¬å‘Š/æè¿°
  address?: string; // åº—é“ºè¯¦ç»†åœ°å€
}

/**
 * èœå“å£å‘³æ¨¡å‹
 */
export class DishFlavor {
  id: number;
  dishId: number; // èœå“id
  name: string; // å£å‘³åç§°
  value: string; //å£å‘³æ•°æ®, åç«¯ä¼ æ¥çš„æ˜¯JSONå­—ç¬¦ä¸²ï¼Œå¦‚ '["ä¸è¾£", "å¾®è¾£"]'

  constructor(id: number, dishId: number, name: string, value: string) {
    this.id = id;
    this.dishId = dishId;
    this.name = name;
    this.value = value;
  }
}

/**
 * å¦®å¨…çš„é­”æ³• âœ¨: æŠŠåç«¯ä¼ æ¥çš„å£å‘³JSONå­—ç¬¦ä¸²å®‰å…¨åœ°è§£ææˆæ•°ç»„
 * è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥å…·å‡½æ•°ï¼Œé¿å…äº† `this` æŒ‡å‘å’Œç±»å®ä¾‹çš„é—®é¢˜
 * @param value æ¥è‡ª DishFlavor.value çš„å­—ç¬¦ä¸²
 * @returns string[]
 */
export function parseFlavorOptions(value: string): string[] {
  try {
    // æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦çœ‹èµ·æ¥åƒä¸€ä¸ªæ•°ç»„
    if ( value && value.startsWith('[') && value.endsWith(']') ) {
      const options: string[] = JSON.parse(value);
      if ( Array.isArray(options) ) {
        return options;
      }
    }
    // å¦‚æœå®ƒä¸æ˜¯JSONæ•°ç»„å­—ç¬¦ä¸² (æ¯”å¦‚ "åŠ å†°", "æ ‡å‡†"), ä½†ä¹Ÿä¸æ˜¯ç©ºçš„,
    // å°±æŠŠå®ƒå½“ä½œä¸€ä¸ªå•ä¸€å…ƒç´ çš„æ•°ç»„è¿”å›
    return value ? [ value ] : [];
  } catch ( e ) {
    console.error(`[ShopModel] è§£æå£å‘³valueå¤±è´¥: "${ value }"`, e);
    // å¦‚æœè§£æJSONå‡ºé”™ï¼Œä¹ŸæŠŠå®ƒå½“ä½œå•ä¸€å…ƒç´ è¿”å›ï¼Œä¿è¯UIä¸å´©æºƒ
    return value ? [ value ] : [];
  }
}


/**
 * èœå“æ¨¡å‹
 */
export class DishVO {
  id: number;
  name: string; // èœå“åç§°
  categoryId: number; // èœå“åˆ†ç±»id
  price: number; // èœå“ä»·æ ¼
  image: string; // å›¾ç‰‡åœ°å€
  description: string; // è¯¦ç»†ä¿¡æ¯
  status: number; // çŠ¶æ€ 0 åœå”® 1 èµ·å”®
  categoryName: string; // åˆ†ç±»åç§°
  flavors: Array<DishFlavor>; // èœå“å£å‘³åˆ—è¡¨

  constructor(id: number, name: string, categoryId: number, price: number, image: string, description: string,
    status: number, categoryName: string, flavors: Array<DishFlavor>) {
    this.id = id;
    this.name = name;
    this.categoryId = categoryId;
    this.price = price;
    this.image = image;
    this.description = description;
    this.status = status;
    this.categoryName = categoryName;
    this.flavors = flavors;
  }
}

/**
 * æŸ¥è¯¢èœå“æ¨¡å‹
 */
export class DishQueryDTO {
  categoryId: number;

  constructor(categoryId: number) {
    this.categoryId = categoryId;
  }
}

/**
 * å¥—é¤æ¨¡å‹
 */
export class SetMealVO {
  id: number;
  categoryId: number;
  name: string;
  price: number;
  status: number;
  description: string;
  image: string;

  constructor(id: number, categoryId: number, name: string, price: number, status: number, description: string, image: string) {
    this.id = id;
    this.categoryId = categoryId;
    this.name = name;
    this.price = price;
    this.status = status;
    this.description = description;
    this.image = image;
  }
}

/**
 * ğŸ“¦ èšåˆç±»ï¼šåˆ†ç±» + è¯¥åˆ†ç±»ä¸‹çš„èœå“åˆ—è¡¨
 * (åŸ MockData ä¸­è¿ç§»è‡³æ­¤ âœ¨)
 */
export class CategoryWithItems {
  category: CategoryVO;
  items: DishVO[];

  constructor(category: CategoryVO, items: DishVO[]) {
    this.category = category;
    this.items = items;
  }
}

// ç›‘å¬è£…é¥°å™¨
@Observed
export class CartItem {
  dishId?: number; // èœå“ID (å¯é€‰)
  setmealId?: number; // å¥—é¤ID (å¯é€‰)
  name: string;
  image: string;
  price: number;
  count: number;
  flavors: string; // å·²é€‰å£å‘³å­—ç¬¦ä¸²ï¼Œå¦‚ "å¾®è¾£, åŠ è‘±"

  constructor(dishId: number | undefined, setmealId: number | undefined, name: string, image: string, price: number, count: number, flavors: string) {
    this.dishId = dishId;
    this.setmealId = setmealId;
    this.name = name;
    this.image = image;
    this.price = price;
    this.count = count;
    this.flavors = flavors;
  }

  // ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªè§„æ ¼çš„èœ
  get uniqueKey(): string {
    return `${ this.dishId ?? 'null' }_${ this.setmealId ?? 'null' }_${ this.flavors }`;
  }
}