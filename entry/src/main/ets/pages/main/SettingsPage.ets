import { promptAction } from '@kit.ArkUI';
import { AuthService } from '../../service/AuthService';

/**
 * è®¾ç½®é¡µé¢
 */
@Component
export struct SettingsPage {
  @Consume('pageStack') pageStack: NavPathStack;

  async handleLogout() {
    AlertDialog.show({
      title: 'é€€å‡ºç™»å½•',
      message: 'ä¸»äººçœŸçš„è¦ç¦»å¼€å¦®å¨…å—ï¼ŸðŸ˜¿',
      primaryButton: {
        value: 'å–æ¶ˆ', action: () => {
        }
      },
      secondaryButton: {
        value: 'ç¡®è®¤é€€å‡º',
        action: async() => {
          await AuthService.logout();
          this.pageStack.clear();
          this.pageStack.pushPath({ name: 'Login' });
        }
      }
    });
  }

  build() {
    NavDestination() {
      Column() {
        // è‡ªå®šä¹‰æ ‡é¢˜æ 
        Row() {
          SymbolGlyph($r('sys.symbol.chevron_left'))
            .fontSize(24)
            .fontColor([ '#333' ])
            .onClick(() => this.pageStack.pop())

          Text('è®¾ç½®')
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .layoutWeight(1)
            .textAlign(TextAlign.Center)
            .margin({ right: 24 })
        }
        .width('100%')
        .height(56)
        .padding({ left: 16, right: 16 })
        .backgroundColor(Color.White)

        List() {
          ListItemGroup() {
            this.SettingItem('ä¸ªäººèµ„æ–™', () => {
              this.pageStack.pushPath({ name: 'UserProfilePage' });
            })
            this.SettingItem('è´¦å·å®‰å…¨', () => {
              this.pageStack.pushPath({ name: 'AccountSecurityPage' });
            })
          }
          .backgroundColor(Color.White)
          .margin({ top: 12 })
          .divider({
            strokeWidth: 0.5,
            color: '#F0F0F0',
            startMargin: 16,
            endMargin: 16
          })

          ListItemGroup() {
            this.SettingItem('æ¸…ç†ç¼“å­˜', () => promptAction.showToast({ message: 'ç¼“å­˜å·²æ¸…ç†å¹²å‡€å–µï¼âœ¨' }))
            this.SettingItem('å…³äºŽæˆ‘ä»¬', () => promptAction.showToast({ message: 'å¦®å¨… v1.0' }))
          }
          .backgroundColor(Color.White)
          .margin({ top: 12 })
          .divider({
            strokeWidth: 0.5,
            color: '#F0F0F0',
            startMargin: 16,
            endMargin: 16
          })

          // é€€å‡ºæŒ‰é’®
          ListItem() {
            Button('é€€å‡ºç™»å½•')
              .width('90%')
              .height(45)
              .margin({ top: 40 })
              .type(ButtonType.Capsule)
              .backgroundColor(Color.White)
              .fontColor('#FF3B30')
              .border({ width: 1, color: '#FF3B30' })
              .onClick(() => this.handleLogout())
          }
          .width('100%')
        }
        .width('100%')
        .layoutWeight(1)
        .backgroundColor('#F5F5F5')
      }
      .width('100%')
      .height('100%')
    }
    .hideTitleBar(true)
  }

  @Builder
  SettingItem(title: string, onClick: () => void) {
    ListItem() {
      Row() {
        Text(title).fontSize(16).fontColor('#333').layoutWeight(1)
        SymbolGlyph($r('sys.symbol.chevron_right'))
          .fontSize(16)
          .fontColor([ '#CCC' ])
      }
      .width('100%')
      .height(54)
      .padding({ left: 16, right: 16 })
      .onClick(onClick)
    }
  }
}
