import { OrderVO } from '../../model/api/OrderModel';

/**
 * æ”¯ä»˜æˆåŠŸé¡µé¢å‚æ•°
 */
export interface PaySuccessPageParams {
  orderId: number;     // âœ¨ æ–°å¢ž orderIdï¼Œç”¨äºŽç²¾å‡†æŸ¥è¯¢è¯¦æƒ…
  orderNumber: string; // è®¢å•å· (æ˜¾ç¤ºç”¨)
  amount: number;
}

@Component
export struct PaySuccessPage {
  @Consume('pageStack') pageStack: NavPathStack;
  @State orderId: number = 0;
  @State orderNumber: string = '';
  @State amount: number = 0;

  build() {
    NavDestination() {
      Column() {
        // é¡¶éƒ¨ç©ºç™½
        Blank().height(80)

        // æˆåŠŸå›¾æ ‡
        Column() {
          SymbolGlyph($r('sys.symbol.checkmark_circle_fill'))
            .fontSize(100)
            .fontColor([Color.Green])
          
          Text('æ”¯ä»˜æˆåŠŸ')
            .fontSize(24)
            .fontWeight(FontWeight.Bold)
            .margin({ top: 20 })
          
          Text('ç¾Žé£Ÿæ­£åœ¨å…¨é€Ÿå¥”å‘æ‚¨å–µï¼ðŸš€')
            .fontSize(14)
            .fontColor('#666')
            .margin({ top: 10 })
        }
        .width('100%')
        .alignItems(HorizontalAlign.Center)

        // è¯¦æƒ…å¡ç‰‡
        Column() {
          Row() {
            Text('å®žä»˜é‡‘é¢').fontSize(14).fontColor('#999')
            Blank()
            Text(`Â¥${this.amount.toFixed(2)}`).fontSize(16).fontWeight(FontWeight.Bold)
          }
          .width('100%')
          .padding({ top: 15, bottom: 15 })

          Divider().color('#F5F5F5')

          Row() {
            Text('è®¢å•ç¼–å·').fontSize(14).fontColor('#999')
            Blank()
            Text(this.orderNumber).fontSize(14).fontColor('#333') 
          }
          .width('100%')
          .padding({ top: 15, bottom: 15 })
        }
        .margin({ top: 50, left: 20, right: 20 })
        .padding(20)
        .backgroundColor(Color.White)
        .borderRadius(12)

        Blank()

        // æŒ‰é’®ç»„
        Column({ space: 15 }) {
          Button('è¿”å›žé¦–é¡µ')
            .width('90%')
            .height(45)
            .type(ButtonType.Capsule)
            .backgroundColor('#FFCC00')
            .fontColor('#333')
            .onClick(() => {
              this.pageStack.clear();
              this.pageStack.pushPath({ name: 'MainTabs' });
            })

          Button('æŸ¥çœ‹è®¢å•')
            .width('90%')
            .height(45)
            .type(ButtonType.Capsule)
            .backgroundColor(Color.Transparent)
            .fontColor('#666')
            .border({ width: 1, color: '#DDD' })
            .onClick(() => {
              // âœ¨ è·³è½¬åˆ°è®¢å•è¯¦æƒ…é¡µ
              if (this.orderId > 0) {
                // æž„é€ ä¸€ä¸ªåŒ…å« ID çš„ç®€æ˜“ OrderVO å¯¹è±¡ï¼Œè¯¦æƒ…é¡µä¼šè‡ªåŠ¨é€šè¿‡æŽ¥å£åˆ·æ–°å®Œæ•´æ•°æ®å–µï¼
                const orderData: OrderVO = {
                  id: this.orderId,
                  number: this.orderNumber,
                  amount: this.amount,
                  status: 2, // å·²æ”¯ä»˜ä¸€èˆ¬çŠ¶æ€ä¸ºå¾…æŽ¥å•
                  orderTime: '',
                  orderDetailList: [],
                  shopId: 0 // åŽç«¯è¯¦æƒ…æŽ¥å£ä¼šè¡¥é½
                };
                // ä½¿ç”¨ replacePath ä»¥å…ç‚¹å‡»è¿”å›žåˆå›žåˆ°æ”¯ä»˜æˆåŠŸé¡µå–µ
                this.pageStack.replacePath({ name: 'OrderDetailPage', param: [orderData] });
              } else {
                // å…œåº•æ–¹æ¡ˆï¼šå›žåˆ—è¡¨
                this.pageStack.replacePath({ name: 'OrderHistoryPage' });
              }
            })
        }
        .margin({ bottom: 50 })
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#F9F9F9')
    }
    .hideTitleBar(true)
    .onReady((context: NavDestinationContext) => {
      this.pageStack = context.pathStack;
      const params = context.pathInfo.param as PaySuccessPageParams;
      if (params) {
        this.orderId = params.orderId;
        this.orderNumber = params.orderNumber;
        this.amount = params.amount;
      }
    })
  }
}