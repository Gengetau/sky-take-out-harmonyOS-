import { promptAction } from '@kit.ArkUI';
import { ShopVO } from '../../../model/entity/ShopModel';

/**
 * å•†åº—å¤´éƒ¨é‡æ„ç‰ˆ - å±•ç°çœŸå®å•†æˆ·é£é‡‡å–µ âœ¨
 */
@Component
export struct ShopHeader {
  @Prop isShopOpen: boolean;
  @Prop shopInfo: ShopVO | null;

  build() {
    Stack({ alignContent: Alignment.Bottom }) {

      // 1. èƒŒæ™¯å¤§å›¾ (å¸¦æ¨¡ç³Šæ•ˆæœ)
      Image(this.shopInfo?.avatar || $r('app.media.shop_header'))
        .width('100%')
        .height(100)
        .objectFit(ImageFit.Cover)
        .blur(15)

      // 2. å†…å®¹å¡ç‰‡ (ç™½è‰²æ‚¬æµ®å¡ç‰‡)
      Row() {
        // (1) å·¦ä¾§ Logo
        Image(this.shopInfo?.avatar || $r('app.media.shop_logo'))
          .width(60)
          .height(60)
          .borderRadius(4)
          .margin({ right: 10 })
          .shadow({ radius: 5, color: '#33000000', offsetY: 2 })
          .objectFit(ImageFit.Cover)

        // (2) ä¸­é—´ä¿¡æ¯
        Column({ space: 5 }) {
          // åº—å + æ ‡ç­¾
          Row() {
            Text(this.shopInfo?.name || 'å•†å®¶åŠ è½½ä¸­...')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .fontColor('#333333')
              .layoutWeight(1)
              .maxLines(1)
              .textOverflow({ overflow: TextOverflow.Ellipsis })

            // æ ¹æ®çŠ¶æ€æ˜¾ç¤º
            if ( this.isShopOpen ) {
              Text('è¥ä¸šä¸­')
                .fontSize(10)
                .fontColor(Color.White)
                .backgroundColor('#4CD964')
                .padding({
                  left: 4,
                  right: 4,
                  top: 2,
                  bottom: 2
                })
                .borderRadius(2)
                .margin({ left: 8 })
            } else {
              Text('ä¼‘æ¯ä¸­')
                .fontSize(10)
                .fontColor(Color.White)
                .backgroundColor('#AAAAAA')
                .padding({
                  left: 4,
                  right: 4,
                  top: 2,
                  bottom: 2
                })
                .borderRadius(2)
                .margin({ left: 8 })
            }
          }.width('100%')

          // é…é€ä¿¡æ¯ Row
          Row() {
            // ğŸ“ è·ç¦» (å¦‚æœæœ‰çš„è¯)
            if ( this.shopInfo?.distance ) {
              SymbolGlyph($r('sys.symbol.local'))
                .fontSize(12)
                .fontColor([ '#0D9FFB' ])
                .margin({ right: 2 })
              Text(this.shopInfo.distance).fontSize(10).fontColor('#0D9FFB')
              Text(' | ').fontSize(10).fontColor('#DDDDDD').margin({ left: 5, right: 5 })
            }

            // ğŸ’° é…é€è´¹
            Text(`é…é€ ï¿¥${ this.shopInfo?.shippingFee ?? 0 }`).fontSize(10).fontColor('#666666')

            // åˆ†å‰²çº¿
            Text(' | ').fontSize(10).fontColor('#DDDDDD').margin({ left: 5, right: 5 })

            // ğŸ•’ æ—¶é—´
            Text(`çº¦ ${ this.shopInfo?.averageDeliveryTime ?? 0 } min`).fontSize(10).fontColor('#666666')
          }

          // å…¬å‘Š (å•è¡Œçœç•¥)
          Text(this.shopInfo?.description || 'æ¬¢è¿å…‰ä¸´æœ¬å°åº—å–µ~')
            .fontSize(10)
            .fontColor('#999999')
            .maxLines(1)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .width('100%')
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)

        // (3) å³ä¾§æ”¶è—/ç”µè¯æŒ‰é’®
        Column() {
          SymbolGlyph($r('sys.symbol.heart'))
            .fontSize(20)
            .fontColor([ '#333333' ])
            .margin({ bottom: 4 })
          Text('å…³æ³¨').fontSize(10).fontColor('#333')
        }
        .justifyContent(FlexAlign.Center)
        .width(40)
        .onClick(() => promptAction.showToast({ message: 'å…³æ³¨æˆåŠŸå–µï¼ğŸ’–' }))

      }
      .width('94%')
      .height(80)
      .backgroundColor(Color.White)
      .borderRadius(8)
      .padding(10)
      .margin({ bottom: 10 })
      .shadow({ radius: 10, color: '#10000000', offsetY: 5 })

    }
    .width('100%')
    .height(120)
    .backgroundColor('#F5F5F5')
  }
}
