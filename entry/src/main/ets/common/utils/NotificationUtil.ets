import { notificationManager } from '@kit.NotificationKit';
import { common } from '@kit.AbilityKit';
import { BusinessError } from '@kit.BasicServicesKit';

/**
 * ç³»ç»Ÿé€šçŸ¥å·¥å…·ç±» ğŸ””
 * å°è£… NotificationKit èƒ½åŠ›ï¼Œæä¾›ä¾¿æ·çš„é€šçŸ¥å‘å¸ƒæ¥å£
 */
export class NotificationUtil {
  
  /**
   * ç”³è¯·é€šçŸ¥æƒé™
   * @param context UIAbilityContext
   */
  static async requestNotificationPermission(context: common.UIAbilityContext): Promise<void> {
    try {
      await notificationManager.requestEnableNotification(context);
      console.info('å–µï¼é€šçŸ¥æƒé™ç”³è¯·å·²è°ƒç”¨');
    } catch (err) {
      console.error(`ç”³è¯·é€šçŸ¥æƒé™å¤±è´¥å–µ: code: ${(err as BusinessError).code}, message: ${(err as BusinessError).message}`);
    }
  }

  /**
   * å‘å¸ƒåŸºç¡€æ–‡æœ¬é€šçŸ¥
   * @param title é€šçŸ¥æ ‡é¢˜
   * @param text é€šçŸ¥å†…å®¹
   * @param id é€šçŸ¥ID (å¯é€‰ï¼Œç”¨äºè¦†ç›–)
   */
  static async publishBasicNotification(title: string, text: string, id: number = 1001) {
    // æ„é€  NotificationRequest å¯¹è±¡
    const notificationRequest: notificationManager.NotificationRequest = {
      id: id,
      content: {
        notificationContentType: notificationManager.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT, // æ™®é€šæ–‡æœ¬ç±»å‹
        normal: {
          title: title,
          text: text,
          additionalText: 'Meowå¤–å–' // é™„åŠ ä¿¡æ¯ï¼Œé€šå¸¸æ˜¾ç¤ºåœ¨æœ€å
        }
      },
      // è®¾ç½®ç‚¹å‡»é€šçŸ¥åçš„åŠ¨ä½œ (å¯é€‰ï¼Œæ¯”å¦‚æ‹‰èµ·åº”ç”¨)
      // wantAgent: ... 
      deliveryTime: new Date().getTime(),
      showDeliveryTime: true,
      groupName: 'meow_delivery_msg', // æ¶ˆæ¯åˆ†ç»„
      // slotType: notificationManager.SlotType.SOCIAL_COMMUNICATION // ç¤¾äº¤ç±»å‹é€šçŸ¥ï¼Œä¼˜å…ˆçº§è¾ƒé«˜
    };

    try {
      await notificationManager.publish(notificationRequest);
      console.info(`å–µï¼é€šçŸ¥å‘å¸ƒæˆåŠŸ: [${title}] ${text}`);
    } catch (err) {
      console.error(`å‘å¸ƒé€šçŸ¥å¤±è´¥å–µ: code: ${(err as BusinessError).code}, message: ${(err as BusinessError).message}`);
    }
  }
}
