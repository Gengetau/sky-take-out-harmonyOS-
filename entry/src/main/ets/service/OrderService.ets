import { AddressBook } from '../model/entity/AddressBook';
import { OrderSubmitDTO, OrderSubmitVO, OrderPaymentDTO, OrderPaymentVO, OrderVO, PageResult, OrderCancelDTO } from '../model/api/OrderModel';
import { HttpUtil } from '../common/utils/HttpUtil';

/**
 * è®¢å•æœåŠ¡
 * è´Ÿè´£å¤„ç†ä¸‹å•ã€æ”¯ä»˜ã€åœ°å€æŸ¥è¯¢ä»¥åŠå†å²è®¢å•æŸ¥è¯¢é€»è¾‘ å–µï¼
 */
export class OrderService {
  
  /**
   * è·å–é»˜è®¤æ”¶è´§åœ°å€
   */
  static async getDefaultAddress(): Promise<AddressBook | null> {
    try {
      return await HttpUtil.get<AddressBook>('/client/addressBook/default');
    } catch (e) {
      console.warn('å–µï¼è·å–é»˜è®¤åœ°å€å¤±è´¥æˆ–æ— é»˜è®¤åœ°å€:', e);
      return null;
    }
  }

  /**
   * è·å–å½“å‰ç”¨æˆ·çš„æ‰€æœ‰åœ°å€
   */
  static async getAddressList(): Promise<AddressBook[]> {
    return HttpUtil.get<AddressBook[]>('/client/addressBook/list');
  }

  /**
   * æ–°å¢åœ°å€
   * @param address åœ°å€ä¿¡æ¯
   */
  static async addAddress(address: AddressBook): Promise<string> {
    return HttpUtil.post<string>('/client/addressBook', address);
  }

  /**
   * è®¾ç½®é»˜è®¤åœ°å€
   * @param id åœ°å€ID
   */
  static async setDefaultAddress(id: number): Promise<string> {
    return HttpUtil.put<string>(`/client/addressBook/default/${id}`);
  }

  /**
   * åˆ é™¤åœ°å€
   * @param id åœ°å€ID
   */
  static async deleteAddress(id: number): Promise<string> {
    return HttpUtil.delete<string>(`/client/addressBook?id=${id}`);
  }

  /**
   * æ ¹æ®IDæŸ¥è¯¢åœ°å€
   * @param id åœ°å€ID
   */
  static async getAddressById(id: number): Promise<AddressBook> {
    return HttpUtil.get<AddressBook>(`/client/addressBook/${id}`);
  }

  /**
   * ä¿®æ”¹åœ°å€
   * @param address åœ°å€ä¿¡æ¯
   */
  static async updateAddress(address: AddressBook): Promise<string> {
    return HttpUtil.put<string>('/client/addressBook', address);
  }

  /**
   * æäº¤è®¢å•
   * @param submitDTO è®¢å•æäº¤ä¿¡æ¯
   */
  static async submitOrder(submitDTO: OrderSubmitDTO): Promise<OrderSubmitVO> {
    return HttpUtil.post<OrderSubmitVO>('/client/order/submit', submitDTO);
  }

  /**
   * è®¢å•æ”¯ä»˜ (è·å–äºŒç»´ç )
   * @param paymentDTO æ”¯ä»˜ä¿¡æ¯
   */
  static async payment(paymentDTO: OrderPaymentDTO): Promise<OrderPaymentVO> {
    return HttpUtil.put<OrderPaymentVO>('/client/order/payment', paymentDTO);
  }

  /**
   * ğŸ” ä¸»åŠ¨æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€ (API 7.4)
   * @param orderNumber è®¢å•å·
   */
  static async checkPayStatus(orderNumber: string): Promise<string> {
    return HttpUtil.get<string>(`/client/order/checkPayStatus/${orderNumber}`);
  }

  /**
   * ğŸ“¦ æŸ¥è¯¢è®¢å•è¯¦æƒ… (API 7.5)
   * @param id è®¢å•ID
   */
  static async getOrderDetail(id: number): Promise<OrderVO> {
    return HttpUtil.get<OrderVO>(`/client/order/orderDetail/${id}`);
  }

  /**
   * âŒ å–æ¶ˆè®¢å• (API 7.6)
   * @param cancelDTO å–æ¶ˆä¿¡æ¯
   */
  static async cancelOrder(cancelDTO: OrderCancelDTO): Promise<string> {
    return HttpUtil.put<string>('/client/order/cancel', cancelDTO);
  }

  /**
   * ğŸ“œ åˆ†é¡µæŸ¥è¯¢å†å²è®¢å• (API 7.3)
   * @param page é¡µç 
   * @param pageSize æ¯é¡µè®°å½•æ•°
   * @param status è®¢å•çŠ¶æ€ (å¯é€‰)
   */
  static async getHistoryOrders(page: number, pageSize: number, status?: number): Promise<PageResult<OrderVO>> {
    let url = `/client/order/historyOrders?page=${page}&pageSize=${pageSize}`;
    if (status !== undefined) {
      url += `&status=${status}`;
    }
    return HttpUtil.get<PageResult<OrderVO>>(url);
  }
}